## VK Rest Console
Дайте вашему стаффу серверную консоль без необходимости давать доступ к хосту.

[Same guide in English.](/README.md)

## Гайд по настройке.
### 0. Скачиваем
Откройте [страницу релизов](https://github.com/btvoidx/vk-rest-console/releases), скачайте бинарник для вашей ОС (линукс или окнон, потому что вы псих, если хостите сервер с мака), закиньте куда-угодно на ту же машину, где держите tshock сервер.

Запустите. Будет создан стандартный `config.json`, а потом программа вылетит с ошибкой. Так задумано.

### 1. Получаем токен группы ВК
Заходим в группу, жмём *Управление*, затем *Настройки* > *Работа с API*.

Во вкладке **Ключи доступа** жмём *Создать ключ*, отмечаем галочку *Разрешить приложению доступ к сообщениям сообщества*, жмём *Создать*. Копируем созданный ключ и записываем его в `config.json` значением для поля `"VKToken"`

### 2. Подключаем Callback API
Заходим в группу, жмём *Управление*, затем *Настройки* > *Работа с API*.
Во кладке **Callback API** жмём *Добавить сервер*.
- Ставим **Версию API** на **5.131**.
- Ставим **Адрес** на адрес вашего сервера.
- Ставим в **Секретный ключ** любое сложноугадываемое значение.

Записываем **Секретный ключ** в `config.json` значением поля `"VKSecret"`. Делаем то же самое для значения **Строки, которую должен вернуть сервер** значением для `"VKConfirmationToken"`.

### 3. Настраиваем конфиг TShock
Полем для `"TShockConfig"` в `config.json` (*не* в конфиге tshock, тут можно немного запутаться) ставим **абсолютный путь** до `config.json` *tshock'а*. Пример ниже.

В `config.json` *tshock'а* настраиваем `"ApplicationRestTokens"` в соответствии [с официальном гайдом tshock](https://tshock.readme.io/reference/rest-api-endpoints#setting-it-all-up).

После того, как сделали это, нужно добавить `"VKId": {VK_PROFILE_ID}` к каждому токену, который нужно будет использоваьт через ВК.

### 4. Используем
Если всё сделано правильно, любой пользователь, чей id был приставлен к токену tshock, теперь может просто писать команды в личные сообщения группы, и они будут выполнены. Попробуйте написать `/help`.

Учитывайте, что команды, которые нельзя выполнить из обычной консоли TShock, так же нельзя выполнить через ВК.

### Примеры
tshock `config.json`
```json
...
"ApplicationRestTokens": {
  "my_very_own_and_very_secret_rest_token": {
    "Username": "btvoidx",
    "UserGroupName": "superadmin",
    "VKId": 187569882
  },
  "not_mine_and_not_so_secret_rest_token": {
    "Username": "Nikita Matrosoff",
    "UserGroupName": "supersuperadmin",
    "VKId": 206352149
  }
}
```

наш `config.json`
```json
{
  "Port": 80,
  "RestUrl": "http://localhost:7878",
  "TShockConfig": "C:/Users/Admin/server/tshock/config.json",
  "VKConfirmationToken": "ba7bf260",
  "VKSecret": "3vUA8FBVJLpjjQd37ZxqZVFLRi93rRuC",
  "VKKeyboard": "",
  "VKToken": "a9eabd3ef76be720606e010107a339e203fe2cid81b67715ebaf823e8e52380f634516850cf0ab8344bb1"
}
```

## Настройка
Перезапустите программку после редактирования настроек для их применения.

Возможные значения:
- `"Port": 80` - число - Отвечает за порт, на котором запускается сервер. Полезно при запуске вместе с прокси, например Nginx.
- `"RestUrl": "http://localhost:7878"` - строка - Адрес TShock REST api.
- `"TShockConfig": ""` - строка - Абсолютный путь до `config.json` TShock'а.
- `"VKConfirmationToken": ""` - строка - Значение "Строки, которую должен вернуть сервер" из Callback API ВК.
- `"VKSecret": ""` - строка - "Секретный ключ" который отправляется вместе с каждым запросом от ВК.
- `"VKKeyboard": ""` - строка - [Keyboard object](https://vk.com/dev/bots_docs_3), который будет отправляться вместе с результатом команды.
- `"VKToken": ""` - строка - Ключ доступа сообщества с доступом к **сообщениям сообщества**.

## Contribute
Откройте новый issue или пишите в личку где угодно для предложения изменений или репорта ошибок.
